(()=>{"use strict";var e=function(e=[],t=null){this.tasks=JSON.parse(JSON.stringify(e)),this.taskStatus=null==t?new Array(e.length).fill(0):JSON.parse(JSON.stringify(t))};e.prototype.addTask=function(e){this.tasks.push(e),this.taskStatus.push(0)},e.prototype.completeTask=function(e){this.taskStatus[e]=1},e.prototype.removeTask=function(e){this.taskStatus.splice(e,1),this.tasks.splice(e,1)},e.prototype.show=function(){for(let e=0;e<this.tasks.length;e++)console.log(this.taskStatus[e]+" "+this.tasks[e])};var t=function(e,t,n,s,r=!1,i=1){this.title=e||"no title",this.description=t||"no description",this.dueDate=n||JSON.stringify(new Date).slice(1,11),this.priority=i,this.checkList=s,this.isComplete=r},n=function(e,t=[]){this.name=e,this.toDoLists=t};n.prototype.addToProject=function(e){this.toDoLists.push(e)},n.prototype.removeFromProject=function(e){this.toDoLists.splice(e,1)};var s=function(s="anonymous"){this.name=s,this.projects=[new n("default",[new t("Getting started","have fun",JSON.stringify(new Date).slice(1,11),new e(["item 1","item 2"])),new t("Again getting started","have fun again",JSON.stringify(new Date).slice(1,11),new e(["item 3","item 4"]))]),new n("default2",[new t("Getting started2","have fun2",JSON.stringify(new Date).slice(1,11),new e(["item 12","item 22"])),new t("Again getting started2","have fun again2",JSON.stringify(new Date).slice(1,11),new e(["item 32","item 42"]))])]};s.prototype.createNewProject=function(e){tempProj=new n(e),this.projects.push(tempProj)},s.prototype.removeProject=function(e){this.projects.splice(e,1)};var r,i=r={pushUpdate:function(){localStorage.setItem("user",JSON.stringify(this.user))},user:"",setUpUser:function(){if(null==localStorage.getItem("user"))r.user=new s;else{var i=JSON.parse(localStorage.user);Object.setPrototypeOf(i,Object.create(s.prototype)),i.projects.forEach((s=>{s.toDoLists.forEach((n=>{Object.setPrototypeOf(n,Object.create(t.prototype)),Object.setPrototypeOf(n.checkList,Object.create(e.prototype))})),Object.setPrototypeOf(s,Object.create(n.prototype))})),r.user=i}r.pushUpdate()}},o=function(e,t=null){var n=document.createElement("div");return n.className=e,null!=t&&(n.innerHTML=t),n},a=function(e,t,n=""){var s=document.createElement("input");return s.className=e,s.maxLength=t,s.placeholder=n,s},c=function(e,t=null){var n=o("checklistinputitem"),s=o("tick2"),r=a("detail2",100,"add task");return null!=t&&(r.value=t),n.appendChild(s),n.appendChild(r),e.appendChild(n),e},d=function(){var e,t=o("detailedTaskItem"),n=o("plus","+>"),s=a("titleInput",20,"Title"),r=function(e,t,n=""){var s=document.createElement("textarea");return s.className=e,s.maxLength=t,s.placeholder=n,s}("descriptionInput",200,"short description"),i=("duedateInput",(e=document.createElement("input")).className="duedateInput",e.type="date",e.min=JSON.stringify(new Date).slice(1,11),e),d=o("checklistInput");d=c(d);var l=o("saveTask","&#8629;");return t.appendChild(n),t.appendChild(s),t.appendChild(r),t.appendChild(i),t.appendChild(d),t.appendChild(l),n.onclick=e=>{c(e.srcElement.parentNode.childNodes[4])},t},l=function(n){var s={};return s.projectNo=n,s.markTaskAsDone=function(e){var t=e.target,n=JSON.parse(t.parentNode.id);0==i.user.projects[n[0]].toDoLists[n[1]].isComplete?(t.innerHTML="&#10003;",i.user.projects[n[0]].toDoLists[n[1]].isComplete=!0):(t.innerHTML="&#9634;",i.user.projects[n[0]].toDoLists[n[1]].isComplete=!1),i.pushUpdate()},s.markChecklistItem=function(e){var t=e.target,n=JSON.parse(this.id);0==i.user.projects[n[0]].toDoLists[n[1]].checkList.taskStatus[n[2]]?(t.innerHTML="&#10003;",i.user.projects[n[0]].toDoLists[n[1]].checkList.taskStatus[n[2]]=!0):(t.innerHTML="&#9634;",i.user.projects[n[0]].toDoLists[n[1]].checkList.taskStatus[n[2]]=!1),i.pushUpdate()},s.expandTask=function(n){s.renderTasks();var r,a,l,p,u,h,m,f,k,N=document.getElementById(JSON.stringify(n)),v=(r=i.user.projects[n[0]].toDoLists[n[1]],a=1==r.isComplete?"&#10003;":"&#9634;",l=o("tick",a),p=o("title",r.title),u=o("description",r.description),h=o("duedate",r.dueDate.slice(0,10)),m=function(e){var t=o("checklist");for(let i=0;i<e.tasks.length;i++){var n=o("tick");n.innerHTML=0==e.taskStatus[i]?"&#9634;":"&#10003;";var s=o("detail");s.innerHTML=e.tasks[i];var r=o("checklistitem");r.appendChild(n),r.appendChild(s),t.appendChild(r)}return t}(r.checkList),f=o("detailedTaskItem"),k=o("editButton","edit"),f.appendChild(l),f.appendChild(p),f.appendChild(u),f.appendChild(h),f.appendChild(m),f.appendChild(k),f);v.id=N.id,v.childNodes[0].onclick=s.markTaskAsDone,v.lastElementChild.onclick=r=>{var o=JSON.parse(r.target.parentNode.id),a=d(),l=i.user.projects[o[0]].toDoLists[o[1]];a.childNodes[1].value=l.title,a.childNodes[2].value=l.description,a.childNodes[3].value=l.dueDate,a.childNodes[4].firstChild.remove();for(let e=0;e<l.checkList.tasks.length;e++){const t=l.checkList.tasks[e];c(a.childNodes[4],t)}var p=document.getElementById("taskList");a.childNodes[5].onclick=function(r){!function(r){var o=[];r[4].childNodes.forEach((e=>{var t=e.childNodes[1].value;""!=t&&o.push(t)}));var a=new t(r[1].value,r[2].value,r[3].value,new e(o));i.user.projects[n[0]].toDoLists[n[1]]=a,s.renderTasks(),i.pushUpdate()}(r.target.parentNode.childNodes)},p.replaceChild(a,document.getElementById(JSON.stringify(n))),document.getElementsByClassName("titleInput")[0].focus()};var g=0;v.childNodes[4].childNodes.forEach((e=>{e.id=JSON.stringify([n[0],n[1],g++]),e.onclick=s.markChecklistItem})),N.parentNode.replaceChild(v,N)},s.reindexTaskElemId=function(){for(var e=document.getElementById("taskList").firstElementChild,t=0;null!=e;)"plus"!=e.firstChild.firstChild.className&&(e.id=JSON.stringify([s.projectNo,t++])),e=e.nextElementSibling},s.deleteThisTask=function(e){var t=e.target,n=JSON.parse(t.parentNode.id);document.getElementById(t.parentNode.id).remove(),i.user.projects[n[0]].toDoLists.splice(n[1],1),s.reindexTaskElemId(),i.pushUpdate()},s.renderTaskElement=function(e){document.getElementById("taskList").appendChild(e)},s.setMobileProjectName=function(e){document.querySelector("#projName").innerHTML=e},s.renderTasks=function(){document.getElementById("taskList").innerHTML="";var e=i.user.projects[s.projectNo];s.setMobileProjectName(e.name);var t=0;if(null!=e){var n=function(e){var t=e.target;s.expandTask(JSON.parse(t.parentNode.id))};e.toDoLists.forEach((e=>{var r,i,a,c,d,l,p,u,h,m,f=(r=e.isComplete,i=e.title,a=e.description,c=e.dueDate.slice(0,10),d=o("tick",1==r?"&#10003;":"&#9634;"),l=o("title",i),p=o("description",a),u=o("duedate",c),h=o("delete","x"),(m=o("taskItem")).appendChild(d),m.appendChild(l),m.appendChild(p),m.appendChild(u),m.appendChild(h),m);f.childNodes[0].onclick=s.markTaskAsDone;for(let e=1;e<4;e++)f.childNodes[e].onclick=n;f.childNodes[4].onclick=s.deleteThisTask,f.id=JSON.stringify([s.projectNo,t++]),s.renderTaskElement(f)}))}},s},p=function(){var s,r,c;i.setUpUser(),(c=document.getElementById("username")).innerHTML=i.user.name,c.onclick=function(){var e=document.getElementById("username"),t=function(){var e=a("uname",20,"enter name"),t=o("ok","&#8629;"),n=o("username");return n.appendChild(e),n.appendChild(t),n}();t.id="username",t.childNodes[1].onclick=()=>{var e=t.childNodes[0].value;i.user.name=e||"anonymous",i.pushUpdate(),location.reload()},e.parentElement.replaceChild(t,e)},(s=0,r={},r.projectNo=s,r.myTaskRenderer=l(r.projectNo),r.projects=i.user.projects,r.setProjectNo=function(e){r.projectNo=e,r.myTaskRenderer.projectNo=e},r.highlight=()=>{var e=r.projectNo,t=document.getElementsByClassName("name");for(let n=0;n<t.length;n++)t[n].style.borderColor=n==e?"rgb(255, 216, 100)":"rgb(255, 216, 100,0)"},r.openProject=e=>{var t=JSON.parse(e.target.parentNode.id);r.setProjectNo(t),r.highlight(),r.renderProjectList()},r.deleteProject=function(){var e=JSON.parse(this.parentNode.id);i.user.projects.splice([e[0]],1),i.pushUpdate(),p()},r.renderProjectCreator=function(){document.getElementById("projButton").onclick=()=>{var e,t,s,c=document.getElementById("list"),d=(e=a("projInput",20),t=o("projSave","&#8629;"),(s=o("projectItem")).appendChild(e),s.appendChild(t),s);if(d.childNodes[1].onclick=function(e){var t=e.target.parentNode.childNodes[0].value,s=new n(t||"new project");i.user.projects.push(s),r.setProjectNo(r.projectNo),r.renderProjectList(),i.pushUpdate()},0==c.childElementCount)c.appendChild(d);else{var l=document.getElementsByClassName("projectItem");"projInput"!=l[0].childNodes[0].className&&c.insertBefore(d,l[0])}document.getElementsByClassName("projInput")[0].focus()}},r.renderTaskCreator=function(){document.getElementById("button").onclick=function(){if(0!=document.getElementById("list").childElementCount){var n=document.getElementById("taskList"),s=d();if(s.childNodes[5].onclick=function(n){!function(n){var s=[];n[4].childNodes.forEach((e=>{var t=e.childNodes[1].value;""!=t&&s.push(t)}));var o=new t(n[1].value,n[2].value,n[3].value,new e(s));i.user.projects[r.projectNo].toDoLists.unshift(o),r.myTaskRenderer.renderTasks(),i.pushUpdate()}(n.target.parentNode.childNodes)},0==n.childElementCount)n.appendChild(s);else{r.myTaskRenderer.renderTasks();var o=n.firstElementChild;"tick"==o.childNodes[0].className&&n.insertBefore(s,o)}document.getElementsByClassName("titleInput")[0].focus()}else alert("please create a project to add task in")}},r.renderProjectList=function(){r.myTaskRenderer.projectNo=r.projectNo,document.getElementById("list").innerHTML="";var e=0;r.projects.forEach((t=>{var n=function(e){var t=o("name",e),n=o("del",e);n.innerHTML="x",t.innerHTML=e;var s=o("projectItem");return s.appendChild(t),s.appendChild(n),s}(t.name);n.id=JSON.stringify([e++]),document.getElementById("list").appendChild(n),n.childNodes[0].onclick=r.openProject,n.childNodes[1].onclick=r.deleteProject})),r.highlight(),r.myTaskRenderer.renderTasks(),r.renderProjectCreator(),r.renderTaskCreator()},r).renderProjectList(),function(){let e=document.querySelector("#project");document.querySelector("#projSwitch").onclick=()=>{e.style.right="0vw"==e.style.right?"-75vw":"0vw"}}()};p()})();